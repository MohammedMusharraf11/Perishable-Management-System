# OWASP ZAP Automation Framework Configuration
# PMS-T-103: OWASP ZAP automated scan configuration
# For use with: zap.sh -cmd -autorun owasp-zap-config.yaml

env:
  contexts:
    - name: "PMS-API-Context"
      urls:
        - "http://localhost:5000"
      includePaths:
        - "http://localhost:5000/api/.*"
      excludePaths:
        - "http://localhost:5000/health"
      authentication:
        method: "json"
        parameters:
          loginUrl: "http://localhost:5000/api/auth/login"
          loginRequestData: '{"email":"test@example.com","password":"testpassword"}'
        verification:
          method: "response"
          loggedInRegex: '\Qsuccess":true\E'
          loggedOutRegex: '\Qerror\E'

  parameters:
    failOnError: true
    failOnWarning: false
    progressToStdout: true

jobs:
  - type: spider
    parameters:
      context: "PMS-API-Context"
      url: "http://localhost:5000"
      maxDuration: 5
      maxDepth: 5
      maxChildren: 10

  - type: passiveScan-wait
    parameters:
      maxDuration: 5

  - type: activeScan
    parameters:
      context: "PMS-API-Context"
      policy: "API-Minimal"
      maxRuleDurationInMins: 1
      maxScanDurationInMins: 10
      addQueryParam: false
      defaultPolicy: "Default Policy"
      delayInMs: 0
      handleAntiCSRFTokens: true
      injectPluginIdInHeader: false
      scanHeadersAllRequests: true
      threadPerHost: 2

  - type: passiveScan-config
    parameters:
      maxAlertsPerRule: 10
      scanOnlyInScope: true

  - type: report
    parameters:
      template: "traditional-html"
      reportDir: "./security/reports"
      reportFile: "zap-report-{{timestamp}}"
      reportTitle: "PMS Security Scan Report"
      reportDescription: "OWASP ZAP security scan for Perishables Management System"

  - type: report
    parameters:
      template: "traditional-json"
      reportDir: "./security/reports"
      reportFile: "zap-report-{{timestamp}}"

# Risk levels to fail on
risks:
  - high
  - medium
